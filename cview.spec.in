%if 0%(test -d .git && echo 1) == 1
%define git_suffix %(git show | grep '^index' | head -n 1 | sed 's/index \(.*\)\.\..*/\1/'|tr -d '\n')
%endif

Name: @PACKAGE_NAME@
Version: @VERSION@
Release: 1%{?dist}%{?git_suffix}
Summary: PNL Waterfall Visualization Tool
Group: System Environment/Base
License: Private
Source: %{name}-%{version}.tar.gz
BuildRequires: ImageMagick-devel, mesa-libGL-devel, mesa-libGLU-devel, mesa-libOSMesa-devel, freeglut-devel, genders, ftgl-devel
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}

%description
PNL Waterfall Visualization Tool for viewing performance data from jobs on the Super Computers.

%package docs
Summary: PNL cview documentation
Group: System Environment/Documentation
License: Private
BuildRequires: doxygen

%description docs
PNL cview doxygen generated documentation.

%package -n libcview
Summary: PNL common cview library
Group: System Environment/Libraries
License: Private

%description -n libcview
PNL common library for cview packages

%package -n libcview-devel
Summary: PNL common cview library development files
Group: System Environment/Libraries
License: Private

%description -n libcview-devel
PNL development library and files for cview packages

%package -n libcview-data
Summary: PNL common cview data management library
Group: System Environment/Libraries
License: Private

%description -n libcview-data
PNL common data management library for cview packages

%package -n libcview-data-devel
Summary: PNL common cview data management library development files
Group: System Environment/Libraries
License: Private

%description -n libcview-data-devel
PNL development data management library for cview packages

%prep
%setup  -q 

%build
%configure 
%{__make} %{_smp_mflags}
%{__make} docs

%install
DESTDIR="$RPM_BUILD_ROOT" make install
# install tests to sharedir
mkdir -p "$RPM_BUILD_ROOT/%{_datadir}/%{name}/tests"
cp tests/* "$RPM_BUILD_ROOT/%{_datadir}/%{name}/tests"
for name in cview libcview libcview-devel libcview-data libcview-data-devel
do
mkdir -p "$RPM_BUILD_ROOT/%{_datadir}/$name"
cp data/LICENSE.txt "$RPM_BUILD_ROOT/%{_datadir}/$name"
done

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
%doc README
%{_bindir}/cviewall
%{_bindir}/cview
%{_bindir}/oscview
%{_datadir}/%{name}/tests
%{_datadir}/%{name}/*.svg
%{_datadir}/%{name}/*.ggr
%{_datadir}/%{name}/LICENSE.txt

%files docs
%defattr(0644,root,root)
%doc docs/html/*

%files -n libcview
%defattr(-,root,root)
%{_libdir}/libcview.so.0*
%{_datadir}/%{name}/*.ttf*
%{_datadir}/libcview/LICENSE.txt

%files -n libcview-devel
%defattr(-,root,root)
%{_libdir}/libcview.a
%{_libdir}/libcview.so
%{_libdir}/libcview.la
%{_libdir}/pkgconfig/cview.pc
%{_datadir}/libcview-devel/LICENSE.txt

%files -n libcview-data
%defattr(-,root,root)
%{_libdir}/libcview-data.so.0*
%{_datadir}/libcview-data/LICENSE.txt

%files -n libcview-data-devel
%defattr(-,root,root)
%{_libdir}/libcview-data.so
%{_libdir}/libcview-data.la
%{_libdir}/libcview-data.a
%{_libdir}/pkgconfig/cview-data.pc
%{_includedir}/%{name}/*
%{_datadir}/libcview-data-devel/LICENSE.txt

%changelog
* Fri Apr 13 2012 David Brown <david.brown@pnnl.gov> - @VERSION@-1
- Initial Release
