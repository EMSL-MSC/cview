PROJECT(cview)
CMAKE_MINIMUM_REQUIRED(VERSION 2.4.5)
MARK_AS_ADVANCED(CMAKE_BACKWARDS_COMPATIBILITY)
include(CheckFunctionExists)

SET(VERSION_MAJOR 0)
SET(VERSION_MINOR 3)
SET(VERSION_PATCH 0)

#options
OPTION(CVIEW_TEST_BUILD "Build CView Testing Applications" OFF)
OPTION(GCOBJECTDEBUG "Enable Tracking of Object Allocations" OFF)
#deal with tweakbar in special directory
#deal with genders

#detect libraries
IF (UNIX)
	FIND_PROGRAM(GNUSTEP_CONFIG gnustep-config)
	IF(NOT DEFINED GNUSTEP_CONFIG)
		MESSAGE(FATAL_ERROR "Error: gnustep-config not found. exiting")
	ENDIF()
	EXECUTE_PROCESS(COMMAND ${GNUSTEP_CONFIG} --base-libs  OUTPUT_VARIABLE FOUNDATION_LIBRARIES OUTPUT_STRIP_TRAILING_WHITESPACE)
	EXECUTE_PROCESS(COMMAND ${GNUSTEP_CONFIG} --objc-flags OUTPUT_VARIABLE FOUNDATION_FLAGS OUTPUT_STRIP_TRAILING_WHITESPACE)
	#lets control Optimization and debug on our own please
	STRING(REPLACE "-g -O2" "" FOUNDATION_FLAGS ${FOUNDATION_FLAGS})
	MARK_AS_ADVANCED(GNUSTEP_CONFIG)
ENDIF (UNIX)
FIND_PACKAGE(GLUT REQUIRED)
FIND_PACKAGE(OpenGL REQUIRED)
FIND_PACKAGE(ImageMagick COMPONENTS MagickWand REQUIRED)
MARK_AS_ADVANCED(ImageMagick_EXECUTABLE_DIR ImageMagick_MagickWand_INCLUDE_DIR ImageMagick_MagickWand_LIBRARY)
FIND_PACKAGE(PkgConfig)
PKG_CHECK_MODULES(FTGL ftgl)

SET(CMAKE_REQUIRED_INCLUDES ${ImageMagick_MagickWand_INCLUDE_DIR})
SET(CMAKE_REQUIRED_LIBRARIES ${ImageMagick_MagickWand_LIBRARY})
CHECK_FUNCTION_EXISTS(MagickExportImagePixels HAVE_MAGICKEXPORTIMAGEPIXELS)



SET(PKG_DATA_DIR "${CMAKE_INSTALL_PREFIX}/share/${PROJECT_NAME}")

CONFIGURE_FILE(Doxyfile.in ${CMAKE_BINARY_DIR}/Doxyfile)
CONFIGURE_FILE(cview.spec.in ${CMAKE_BINARY_DIR}/cview.spec)
CONFIGURE_FILE(config.h.in ${CMAKE_BINARY_DIR}/config.h)

INCLUDE_DIRECTORIES(${CMAKE_BINARY_DIR})
INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/libcview-data)
INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/libcview)

ADD_SUBDIRECTORY(libcview-data)
LINK_DIRECTORIES(${CMAKE_BINARY_DIR}/libcview-data)
ADD_SUBDIRECTORY(libcview)
LINK_DIRECTORIES(${CMAKE_BINARY_DIR}/libcview)
#ADD_SUBDIRECTORY(data)
IF (CVIEW_TEST_BUILD)
	ADD_SUBDIRECTORY(tests)
ENDIF()
